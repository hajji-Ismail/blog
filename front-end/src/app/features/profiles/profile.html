<div class="container py-4" *ngIf="profile as p">

  <!-- PROFILE HEADER -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex align-items-center gap-3">
      <img [src]="getProfileImage(p.profileImage)" class="rounded-circle border" width="80" height="80" />
      <div class="flex-grow-1">
        <h5 class="mb-1">{{ p.username }}</h5>
        <div class="d-flex gap-3 text-muted small">
          <span><strong>{{ p.followers }}</strong> Followers</span>
          <span><strong>{{ p.following }}</strong> Following</span>
        </div>
      </div>
      
      <!-- If NOT my profile, show Follow and Report User -->
      <div *ngIf="!p.profile" class="d-flex gap-2">
        <button class="btn btn-primary btn-sm" (click)="onFollow(p.username)">{{ p.isFollowing ? "Unfollow" : "Follow" }}</button>
        <button class="btn btn-outline-danger btn-sm" (click)="reportUser()">Report User</button>
      </div>
    </div>
  </div>

  <!-- POSTS -->
  <div *ngIf="(p.post?.length ?? 0) === 0" class="text-center text-muted py-4">No posts yet</div>

  <div *ngFor="let post of (p.post ?? [])" class="card mb-3 shadow-sm">
    <div class="card-body">
      <div class="d-flex align-items-center gap-2 mb-2">
        <img [src]="getProfileImage(post.profileImageUrl)" class="rounded-circle" width="32" height="32" />
        <div>
          <strong>{{ post.username }}</strong><br/>
          <small class="text-muted">{{ post.createdAt | date:'short' }}</small>
        </div>
      </div>

      <h6>{{ post.title }}</h6>
      <p>{{ post.content }}</p>

      <div *ngIf="post.medias?.length">
        <img *ngFor="let m of post.medias" [src]="m" class="img-fluid rounded me-2 mb-2" style="max-height:140px"/>
      </div>

      <div class="d-flex gap-3 text-muted small border-top pt-2">
        <span>‚ù§Ô∏è {{ post.reactionCount }}</span>
        <span>üí¨ {{ post.commentCount }}</span>
      </div>

      <!-- ACTIONS: If p.profile is true, these are MY posts -->
      <div class="mt-3">
        <ng-container *ngIf="p.profile; else notMine">
          <button class="btn btn-sm btn-warning me-2" (click)="openEdit(post)">Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deletePost(post)">Delete</button>
        </ng-container>
        
        <ng-template #notMine>
          <button class="btn btn-sm btn-outline-danger" (click)="reportPost(post)">Report Post</button>
        </ng-template>
      </div>
    </div>
  </div>

</div>

<!-- EDIT MODAL -->
<div *ngIf="editingPost" class="modal-backdrop d-flex justify-content-center align-items-center" style="position: fixed; inset:0; background: rgba(0,0,0,0.5); z-index:1050;">
  <div class="card p-4 shadow" style="width: 400px;">
    <h5>Edit Post</h5>
    <div class="mb-2">
      <label class="small">Title</label>
      <input [(ngModel)]="editTitle" class="form-control" />
    </div>
    <div class="mb-3">
      <label class="small">Content</label>
      <textarea [(ngModel)]="editContent" class="form-control" rows="4"></textarea>
    </div>
    <div class="d-flex justify-content-end gap-2">
      <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Cancel</button>
      <button class="btn btn-primary btn-sm" (click)="saveEdit()">Save Changes</button>
    </div>
  </div>
</div>
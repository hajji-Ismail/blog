<div class="container py-4" *ngIf="profile as p">

  <!-- PROFILE HEADER -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex align-items-center gap-3">

      <!-- PROFILE IMAGE -->
      <img
        [src]="getProfileImage(p.profileImage)"
        class="rounded-circle"
        width="80"
        height="80"
        alt="Profile image"
      />

      <!-- USER INFO -->
      <div class="flex-grow-1">
        <h5 class="mb-1">{{ p.username }}</h5>

        <div class="d-flex gap-3 text-muted small">
          <span><strong>{{ p.followers ?? 0 }}</strong> Followers</span>
          <span><strong>{{ p.following ?? 0 }}</strong> Following</span>
        </div>
      </div>

      <!-- ACTION BUTTON -->
      <div>
        <button
          *ngIf="!p.profile"
          (click)="onfollow(p.username)"
          class="btn btn-sm btn-primary"
        >
          Follow
        </button>
      </div>

    </div>
  </div>

  <!-- POSTS SECTION -->

  <!-- Safe empty check -->
  <div *ngIf="(p.post?.length ?? 0) === 0" class="text-center text-muted">
    No posts yet
  </div>

  <!-- Safe ngFor -->
  <div
    *ngFor="let post of (p.post ?? []); trackBy: trackByPost"
    class="card mb-3 shadow-sm"
  >
    <div class="card-body">

      <!-- POST HEADER -->
      <div class="d-flex align-items-center gap-2 mb-2">
        <img
          [src]="getProfileImage(post?.profileImageUrl)"
          class="rounded-circle"
          width="32"
          height="32"
        />
        <div>
          <strong>{{ post?.username }}</strong><br />
          <small class="text-muted">
            {{ post?.createdAt | date:'short' }}
          </small>
        </div>
      </div>

      <!-- POST CONTENT -->
      <h6 class="mb-1">{{ post?.title }}</h6>
      <p class="mb-2">{{ post?.content }}</p>

      <!-- POST MEDIA -->
      <div *ngIf="post?.medias?.length" class="mb-2">
        <img
          *ngFor="let media of (post?.medias ?? [])"
          [src]="media"
          class="img-fluid rounded me-2 mb-2"
          style="max-height: 140px;"
        />
      </div>

      <!-- POST ACTIONS -->
      <div class="d-flex gap-3 text-muted small">
        <span>‚ù§Ô∏è {{ post?.reactionCount ?? 0 }}</span>
        <span>üí¨ {{ post?.commentCount ?? 0 }}</span>
      </div>

    </div>
  </div>

</div>
